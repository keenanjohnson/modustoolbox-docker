# Only JTAG transport is supported
transport select jtag
adapter speed 2000

reset_config trst_and_srst

set _CHIPNAME cyw55500

jtag newtap $_CHIPNAME cpu -irlen 4
dap create $_CHIPNAME.dap -chain-position $_CHIPNAME.cpu -adiv6 -power-down-on-quit

# target create $_CHIPNAME.cpu.cr4 cortex_r4 -dap $_CHIPNAME.dap -ap-num 0x80000000 -dbgbase 0x80001000
target create $_CHIPNAME.cpu.cm33 cortex_m -dap $_CHIPNAME.dap -ap-num 0x10000

cortex_m reset_config sysresetreq

# Enable Non-Secure access
$_CHIPNAME.dap apsel 0x10000
$_CHIPNAME.dap apcsw [expr {(1 << 25) | (1 << 29) | (1 << 30) | (1 << 31)} ]

# Avoid WAITs on the bus
$_CHIPNAME.dap memaccess 24

adapter srst delay 50

gdb_breakpoint_override hard
